# Online Coding Interview Platform - Implementation Plan

## 1. Project Overview

A real-time collaborative coding interview platform that allows interviewers to create interview sessions, share links with candidates, and collaborate on code in real-time with syntax highlighting and code execution capabilities.

## 2. Technology Stack

### Frontend
- **Framework**: React 18+ with TypeScript
- **State Management**: Zustand (lightweight, TypeScript-friendly)
- **Code Editor**: Monaco Editor (VS Code's editor component)
- **Real-time Communication**: Socket.IO Client
- **Styling**: Tailwind CSS
- **Testing**: 
  - Vitest (unit tests)
  - React Testing Library (component tests)
  - Playwright (E2E tests)
- **Build Tool**: Vite

### Code Execution (Browser-based via WASM)
- **JavaScript**: Native execution in Web Workers (sandboxed)
- **Python**: Pyodide (CPython 3.11 compiled to WebAssembly)
- **C#**: Blazor WebAssembly (.NET runtime in browser)
- **Go**: GopherJS / TinyGo WASM compilation
- **Java**: CheerpJ (JVM in WebAssembly)
- **Execution Environment**: Web Workers for isolation and non-blocking execution

### Backend
- **Framework**: FastAPI (Python 3.11+)
- **Real-time Communication**: Socket.IO (python-socketio)
- **Database**: PostgreSQL (for persistence) + Redis (for real-time session state)
- **Note**: Backend does NOT execute user code (security by design)
- **Testing**:
  - pytest (unit & integration tests)
  - pytest-asyncio (async tests)
  - httpx (API testing)
- **Documentation**: OpenAPI (auto-generated by FastAPI)

### Infrastructure
- **Containerization**: Docker & Docker Compose
- **Reverse Proxy**: Nginx (for production)

## 3. Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            Client Browser                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐ │
│  │  React App      │  │  Monaco Editor  │  │  Web Worker (Execution) │ │
│  │  (UI/State)     │  │  (Code Editor)  │  │  ┌───────────────────┐  │ │
│  │                 │  │                 │  │  │ JavaScript Engine │  │ │
│  │                 │  │                 │  │  ├───────────────────┤  │ │
│  │                 │  │                 │  │  │ Pyodide (WASM)    │  │ │
│  │                 │  │                 │  │  │ Python 3.11       │  │ │
│  └────────┬────────┘  └────────┬────────┘  │  └───────────────────┘  │ │
│           │                    │           └─────────────────────────┘ │
│           └────────────────────┼───────────────────────────────────────┤
│                                │ WebSocket + HTTP                      │
└────────────────────────────────┼───────────────────────────────────────┘
                                 │
┌────────────────────────────────┼───────────────────────────────────────┐
│                         FastAPI Server                                 │
│                    (No Code Execution - Security)                      │
│  ┌─────────────────┐  ┌───────┴───────┐                               │
│  │  REST API       │  │  Socket.IO    │                               │
│  │  (Sessions)     │  │  (Real-time)  │                               │
│  └────────┬────────┘  └───────┬───────┘                               │
│           │                   │                                        │
│           └───────────────────┘                                        │
│                               │                                        │
│  ┌─────────────────┐  ┌───────┴───────┐                               │
│  │  PostgreSQL     │  │    Redis      │                               │
│  │  (Persistence)  │  │  (Sessions)   │                               │
│  └─────────────────┘  └───────────────┘                               │
└────────────────────────────────────────────────────────────────────────┘
```

### Key Security Decision
**All code execution happens in the browser using WebAssembly.** The server never executes user-submitted code, eliminating server-side code injection risks entirely.

## 4. Core Features

### 4.1 Session Management
- Generate unique session links (UUID-based)
- Session metadata (title, language, created_at, expires_at)
- Session expiration (configurable TTL)
- Optional password protection

### 4.2 Real-time Collaboration
- Operational Transformation (OT) or CRDT for conflict resolution
- Cursor position sharing
- User presence indicators
- Connection status display

### 4.3 Code Editor
- Monaco Editor integration
- Syntax highlighting for:
  - JavaScript/TypeScript
  - Python
  - Java
  - C++
  - Go
  - (extensible)
- Theme support (light/dark)
- Line numbers, minimap, code folding

### 4.4 Code Execution (Browser-based WASM)
All code execution happens client-side for security:

- **JavaScript**: 
  - Native execution in isolated Web Worker
  - Sandboxed environment with no DOM access
  - Configurable timeout

- **Python** (via Pyodide):
  - CPython 3.11 compiled to WebAssembly
  - Runs entirely in browser Web Worker
  - Supports most of Python standard library
  - Popular packages available: numpy, pandas, matplotlib, etc.
  - ~10MB initial download (cached after first load)

- **C#** (via Blazor WASM):
  - .NET runtime compiled to WebAssembly
  - Full C# language support
  - .NET Base Class Library available
  - ~15MB initial download (cached)

- **Go** (via TinyGo WASM):
  - TinyGo compiler targeting WebAssembly
  - Most Go standard library supported
  - Smaller binary size than full Go
  - ~5MB initial download

- **Java** (via CheerpJ):
  - Full JVM running in WebAssembly
  - Java 8+ language features
  - Standard library support
  - ~20MB initial download (cached)

**Security Benefits:**
- Zero server-side code execution risk
- User code cannot access server resources
- Browser sandbox provides memory/CPU isolation
- No network access from execution context

### 4.5 Output Panel
- Standard output display
- Error output display
- Execution time metrics
- Clear output functionality

## 5. API Design

### REST Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/sessions` | Create new session |
| GET | `/api/sessions/{id}` | Get session details |
| PATCH | `/api/sessions/{id}` | Update session |
| DELETE | `/api/sessions/{id}` | Delete session |
| GET | `/api/languages` | Get supported languages |

> **Note**: No `/execute` endpoint - all code execution happens client-side via WASM

### WebSocket Events
| Event | Direction | Description |
|-------|-----------|-------------|
| `join` | Client → Server | Join a session |
| `leave` | Client → Server | Leave a session |
| `code_change` | Bidirectional | Code content changed |
| `cursor_move` | Bidirectional | Cursor position changed |
| `user_joined` | Server → Client | User joined session |
| `user_left` | Server → Client | User left session |
| `language_change` | Bidirectional | Programming language changed |

> **Note**: Execution results are handled locally in the browser, not via WebSocket

## 6. Database Schema

### Sessions Table
```sql
CREATE TABLE sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255),
    language VARCHAR(50) DEFAULT 'javascript',
    code TEXT DEFAULT '',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    password_hash VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE
);
```

### Session Participants (Redis)
```
session:{id}:participants -> Set of user IDs
session:{id}:cursors -> Hash of user_id -> cursor position
session:{id}:code -> Current code content
```

## 7. Security Considerations

### Code Execution Security (WASM-based)
All code runs in the browser, providing inherent security:

- **Browser Sandbox**:
  - Web Workers provide isolated execution context
  - No access to main thread DOM
  - No access to cookies, localStorage from worker
  - Memory isolated per worker

- **WASM Isolation**:
  - Pyodide runs in linear memory sandbox
  - Cannot access arbitrary memory
  - No direct system calls
  - No filesystem access (virtual FS only)
  - No network access from WASM context

- **Execution Controls**:
  - Configurable timeout (default 10 seconds)
  - Worker termination on timeout
  - Output size limits
  - Infinite loop detection

- **Server Security**:
  - Server NEVER executes user code
  - Eliminates RCE (Remote Code Execution) vulnerabilities
  - No sandboxing complexity on backend

### API Security
- Rate limiting
- Input validation
- CORS configuration
- Session token validation

## 8. Development Phases

### Phase 1: Foundation (Week 1-2)
- [ ] Project setup (monorepo structure)
- [ ] FastAPI backend skeleton
- [ ] React frontend skeleton
- [ ] Docker development environment
- [ ] Basic CI/CD pipeline

### Phase 2: Core Features (Week 3-4)
- [ ] Session CRUD API
- [ ] Monaco Editor integration
- [ ] WebSocket connection setup
- [ ] Real-time code synchronization
- [ ] Basic UI layout

### Phase 3: Code Execution (Week 5-6)
- [ ] JavaScript execution in Web Worker
- [ ] Pyodide integration for Python WASM execution
- [ ] Lazy loading of Pyodide (with loading indicator)
- [ ] Output panel implementation
- [ ] Error handling and timeout management
- [ ] Execution state synchronization

### Phase 4: Polish & Testing (Week 7-8)
- [ ] User presence indicators
- [ ] Cursor sharing
- [ ] Comprehensive test suite
- [ ] Performance optimization
- [ ] Documentation

### Phase 5: Production Ready (Week 9-10)
- [ ] Production Docker configuration
- [ ] Nginx reverse proxy setup
- [ ] Monitoring & logging
- [ ] Security audit
- [ ] Deployment scripts

## 9. Project Structure

```
online-coding-interview/
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── Editor/
│   │   │   ├── Output/
│   │   │   ├── Toolbar/
│   │   │   └── UserPresence/
│   │   ├── hooks/
│   │   ├── services/
│   │   │   └── executor/
│   │   │       ├── index.ts
│   │   │       ├── javascript-worker.ts
│   │   │       ├── python-worker.ts      # Pyodide WASM
│   │   │       ├── csharp-worker.ts      # Blazor WASM
│   │   │       ├── go-worker.ts          # TinyGo WASM
│   │   │       └── java-worker.ts        # CheerpJ WASM
│   │   ├── store/
│   │   ├── types/
│   │   └── App.tsx
│   ├── tests/
│   ├── package.json
│   └── vite.config.ts
├── backend/
│   ├── app/
│   │   ├── api/
│   │   │   ├── routes/
│   │   │   └── deps.py
│   │   ├── core/
│   │   │   ├── config.py
│   │   │   └── security.py
│   │   ├── models/
│   │   ├── schemas/
│   │   ├── services/
│   │   │   └── session.py
│   │   └── main.py
│   ├── tests/
│   ├── requirements.txt
│   └── Dockerfile
├── docker-compose.yml
├── docker-compose.prod.yml
└── README.md
```

## 10. Testing Strategy

### Frontend Tests
- **Unit Tests**: Individual component logic
- **Integration Tests**: Component interactions
- **E2E Tests**: Full user workflows

### Backend Tests
- **Unit Tests**: Service functions, utilities
- **Integration Tests**: API endpoints, database operations
- **WebSocket Tests**: Real-time communication

### Test Coverage Goals
- Backend: 80%+
- Frontend: 70%+
- Critical paths: 100%

## 11. Technology Alternatives Considered

| Current Choice | Alternative | Reason for Choice |
|---------------|-------------|-------------------|
| Pyodide (WASM) | Server-side Python | Security: no server code execution, eliminates RCE risks |
| Pyodide (WASM) | Brython | Pyodide is real CPython, better stdlib support, numpy/pandas |
| FastAPI | Node.js/Express | FastAPI has better async support, auto-docs, type hints |
| Socket.IO | WebSocket + custom | Socket.IO provides fallbacks, rooms, reconnection |
| Monaco Editor | CodeMirror 6 | Monaco has better TypeScript support, more features |
| PostgreSQL | MongoDB | Relational data better for sessions, PostgreSQL JSON support sufficient |
| Redis | In-memory | Redis provides persistence, pub/sub for scaling |

## 12. Scalability Considerations

For future scaling:
- Redis pub/sub for multi-server WebSocket synchronization
- Kubernetes for container orchestration
- CDN for static assets (including Pyodide WASM bundles)
- Read replicas for database

### WASM Execution Benefits for Scale
- No server CPU used for code execution
- Horizontal scaling only for session management
- Client machines handle compute workload
- Reduced server costs
